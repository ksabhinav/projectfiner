<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<style>

/* Remove default spacing */
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
}

body{
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
    background:#ffffff;
    color:#2b2b2b;
}

/* Header */
.header{
    margin-bottom:10px;
}

h1{
    font-family:serif;
    font-size:1.4rem;
    margin-top:10px;
}

.desc{
    color:#6a6a6a;
    font-style:italic;
    font-size:13px;
}

/* Buttons */
.controls{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    margin:15px 0;
}

.btn{
    padding:10px 16px;
    border:2px solid #2b2b2b;
    background:white;
    cursor:pointer;
    font-size:13px;
    box-shadow:2px 2px 0 0 #2b2b2b;
}

.btn.active{
    background:#e07c3e;
    color:white;
}

/* ‚≠ê PROFESSIONAL MAP CONTAINER */
#map{
    width:100%;
    height:85vh;
    min-height:650px;
    position:relative;
    overflow:hidden;   /* kills scrollbar */
}

/* Responsive SVG */
#svg{
    width:100%;
    height:100%;
    display:block;
}

/* District styling */
.district{
    stroke:#fff;
    stroke-width:2;
    cursor:pointer;
    transition:.2s;
}

.district:hover{
    stroke:#2b2b2b;
    stroke-width:3;
}

/* Labels */
.label{
    font-size:11px;
    font-weight:700;
    pointer-events:none;
    text-anchor:middle;
}

/* Tooltip */
.tooltip{
    position:absolute;
    background:#2b2b2b;
    color:white;
    padding:12px;
    display:none;
    z-index:1000;
    pointer-events:none;
}

.tooltip-title{
    font-weight:700;
}

.tooltip-value{
    font-size:24px;
    color:#ffeb3b;
}

/* Legend */
.legend{
    margin-top:15px;
    display:flex;
    align-items:center;
    gap:10px;
}

.legend-bar{
    flex:1;
    height:14px;
    background:linear-gradient(to right,#f8f8f8,#ffd6ba,#ffab91,#e07c3e,#c05a1e);
}

.legend-value{
    font-weight:600;
}

</style>
</head>

<body>

<div class="header">
<h1 id="title">Loading...</h1>
<div class="desc" id="desc">Please wait while data loads</div>
</div>

<div class="controls" id="controls"></div>

<div id="map">
    <svg id="svg" preserveAspectRatio="xMidYMid meet"></svg>
    <div class="tooltip" id="tooltip"></div>
</div>

<div class="legend">
    <div class="legend-bar"></div>
    <span class="legend-value" id="range"></span>
</div>


<script>

/* ================================
   CONTAINER-FIT PROJECTION
   (The important rewrite)
================================ */

function project(){

    let minX=Infinity,maxX=-Infinity,minY=Infinity,maxY=-Infinity;

    function scan(a){
        a.forEach(i=>{
            if(typeof i[0]==='number'){
                minX=Math.min(minX,i[0]);
                maxX=Math.max(maxX,i[0]);
                minY=Math.min(minY,i[1]);
                maxY=Math.max(maxY,i[1]);
            }else scan(i);
        });
    }

    geoData.features.forEach(f=>scan(f.geometry.coordinates));

    const svg=document.getElementById('svg');
    const box=svg.getBoundingClientRect();

    const width=box.width;
    const height=box.height;

    svg.setAttribute("viewBox",`0 0 ${width} ${height}`);

    const geoWidth=maxX-minX;
    const geoHeight=maxY-minY;

    const padding=10;

    const scale=Math.min(
        (width-padding*2)/geoWidth,
        (height-padding*2)/geoHeight
    );

    const offsetX=(width-geoWidth*scale)/2;
    const offsetY=(height-geoHeight*scale)/2;

    return (lon,lat)=>[
        (lon-minX)*scale + offsetX,
        (maxY-lat)*scale + offsetY
    ];
}


/* ================================
   AUTO RESIZE (VERY IMPORTANT)
================================ */

window.addEventListener('resize',()=>{
    document.getElementById('svg').innerHTML='';
    initMap();  // your existing function
});

</script>

</body>
</html>
